<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Ssh on Wise</title><link>https://wiseweb-works.github.io/blog/en/tags/ssh/</link><description>Recent content in Ssh on Wise</description><generator>Hugo -- 0.138.0</generator><language>en</language><lastBuildDate>Fri, 07 Apr 2023 05:02:05 +0200</lastBuildDate><atom:link href="https://wiseweb-works.github.io/blog/en/tags/ssh/index.xml" rel="self" type="application/rss+xml"/><item><title>Increasing SSH security on Linux Servers</title><link>https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/</link><pubDate>Tue, 05 Oct 2021 00:00:00 +0000</pubDate><guid>https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/</guid><description>&lt;h1 id="increasing-ssh-security-on-linux-servers">Increasing SSH security on Linux Servers&lt;/h1>
&lt;p>Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem.&lt;/p></description><content:encoded><![CDATA[<h1 id="increasing-ssh-security-on-linux-servers">Increasing SSH security on Linux Servers</h1>
<p>Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem.</p>
<h2 id="simple-safety-precautions">Simple Safety Precautions</h2>
<p>First, we need to install the updates via the console with the package manager of the Linux version we are in.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Ubuntu: sudo apt update <span style="color:#f92672">&amp;&amp;</span> sudo apt upgrade -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fedora: sudo yum update -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Arch Linux: sudo pacman -Syyu
</span></span></code></pre></div><p>After the updates are installed, we start configuring the SSHD service (which is the service that allows you to receive ssh connections from outside) on your server (Ubuntu in my case). Foremost, due to the confusion, it should be noted that the ssh service and the SSHD service are different services. While the SSH service is the service that connects the server to other computers or servers, the SSHD service is the service that allows other computers to connect to your server, that is, incoming connections.</p>
<p>The file that keeps the settings of the SSHD service is generally located at “/etc/ssh/sshd_config”. We need to open it with any of the text editors we use, but with a user with sudo (ie administrator) privileges.</p>
<p>If we continue on, Ubuntu</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/ssh/sshd_config <span style="color:#75715e"># Command to open the settings file</span>
</span></span></code></pre></div><p>Titles we will find and replace</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#ClientAliveInterval 0 &gt;&gt; We remove the hashtag at the beginning and change the value from &#34;0&#34; to 300. This command regulates the automatic closing of the connection after how many seconds when the connection is not used (it stays in the idle position).
</span></span><span style="display:flex;"><span>#PermitEmptyPasswords no &gt;&gt; We remove the hashtag at the beginning and do not change the &#34;no&#34; value. This command prevents blank or unencrypted users from connecting. So it doesn&#39;t allow empty passwords.
</span></span><span style="display:flex;"><span>X11Forwarding yes &gt;&gt; If there is a hashtag at the beginning, we remove it, otherwise we change the &#34;yes&#34; value to no. Although this command provides ease of running applications with GUI interface on the server, we close it because it is possible to abuse it.
</span></span><span style="display:flex;"><span>#MaxAuthTries 6 &gt;&gt; We remove the hashtag at the beginning and change the value from &#34;6&#34; to 3. This command regulates how many times they can try your password. The number 6 is an unnecessarily high value and the general acceptance is 3 or 4.
</span></span><span style="display:flex;"><span>#Protocol 2 &gt;&gt; If there is a hashtag at the beginning, we remove it, if there is no such record, we add the value in the form of &#34;Protocol 2&#34; to the first space we find. This command ensures that connections are made only with the latest SSH protocol, protecting you from vulnerabilities of the old protocol.
</span></span></code></pre></div><p>If you want to check after making the settings: You can use the command &ldquo;sudo sshd -t&rdquo;. If you do not see an error message, you can apply the settings and restart the service with the command &ldquo;sudo systemctl restart sshd&rdquo; or &ldquo;sudo service sshd restart&rdquo;</p>
<h2 id="recommended-settings">Recommended settings</h2>
<p>In addition to the previous settings, we will make additional settings such as user-based login, login using only secure key and restrict login with Root user. First you need to generate a secret key for your user on your local computer. For this, if you are using a linux-based operating system</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>After typing ssh-keygen -t rsa -b 4096 #, enter the password you want in response to the questions below
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;&gt; Enter passphrase (empty for no passphrase): [Press enter key]
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;&gt; Enter same passphrase again: [Press enter key]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>or
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ssh-keygen -t ecdsa -b 521 # Generates more secure and faster ecliptic key. Enter the password you want in response to the questions below
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;&gt; Enter passphrase (empty for no passphrase): [Press enter key]
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;&gt; Enter same passphrase again: [Press enter key]
</span></span></code></pre></div><p>If you answered other questions by pressing Enter and did not type a specific location for the key, your key pair (.pub= public key) / private key without extension) is saved in the /home/USER_NAME/.ssh folder. You can use the code below to introduce the key you generated to your server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ssh-copy-id -i ~/.ssh/KEY_NAME.pub After typing USER_NAME@SERVER_IP_ADRESS # on the SERVER, it will ask for your user&#39;s password and if you enter it correctly, you will see a confirmation message.
</span></span></code></pre></div><p>After generating your own key, to access the server only with the key;
Titles we will find and replace</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#PasswordAuthentication no &gt;&gt; We remove the hashtag at the beginning and leave the &#34;no&#34; value as no. This command prevents connecting to the server with a password. Users can only connect with ssh_keys.
</span></span><span style="display:flex;"><span>PubkeyAuthentication yes &gt;&gt; If there is, we remove the hash mark at the beginning and set the value as yes. This command is the command that allows you to log in with the secret key you just created.
</span></span><span style="display:flex;"><span>#PermitRootLogin no &gt;&gt; We remove the hashtag at the beginning and leave the &#34;no&#34; value as no. This command prevents the ROOT user, who is the most authorized user, from accessing the server. However, you can access it with another user and then switch to the ROOT user.
</span></span><span style="display:flex;"><span>AllowUsers YOUR USERNAME &gt;&gt; If it doesn&#39;t exist, we add such a record. It prevents other users from connecting to the server and/or attempting a username.
</span></span><span style="display:flex;"><span>LoginGraceTime 20 &gt;&gt; If not, we add such a record and set the value to 20. Determines the time required to log in, in seconds. We prevent them from keeping the server busy with a long login request.
</span></span><span style="display:flex;"><span>ChallengeResponseAuthentication no &gt;&gt; If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span><span style="display:flex;"><span>KerberosAuthentication no &gt;&gt; If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span><span style="display:flex;"><span>GSSAPIAuthentication no &gt;&gt; If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span></code></pre></div><p>If you want to check after making the settings: You can use the command &ldquo;sudo sshd -t&rdquo;. If you do not see an error message, you can apply the settings and restart the service with the command &ldquo;sudo systemctl restart sshd&rdquo; or &ldquo;sudo service sshd restart&rdquo;</p>
<h2 id="advanced-settings">Advanced Settings</h2>
<p>First of all, we will change the standard SSH connection port, 22, and then make the encryption tools used during SSH connection even stronger. Then we will determine how the logs (registry records) of the server SSH service are kept.</p>
<p>Titles we will find and replace</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#Port 22 &gt;&gt; We find this and remove the hash mark at the beginning and write there a port number that is not used by any other service and is open. For example, it could be 2992.
</span></span><span style="display:flex;"><span>LogLevel INFO &gt;&gt; We find this setting and change it, if not, we add it. It helps us to set the recording level.
</span></span><span style="display:flex;"><span>AllowAgentForwarding no &gt;&gt; We find this setting and change it, if not, we add it. Disables alternative routing methods.
</span></span><span style="display:flex;"><span>AllowTcpForwarding no &gt;&gt; We find this setting and change it, if not, we add it. Disables alternative routing methods.
</span></span><span style="display:flex;"><span>PrintMotd no &gt;&gt; We find this setting and change it, if not, we add it. To prevent them from knowing about the server before the connection is established.
</span></span><span style="display:flex;"><span>PermitUserEnvironment no &gt;&gt; We find this setting and change it, if not, we add it.
</span></span><span style="display:flex;"><span>PermitTunnel no &gt;&gt; We find this setting and change it, if not, we add it.
</span></span></code></pre></div><p>We go further and determine which of the encryption algorithms, authentication algorithms, key exchange algorithms and other algorithms used during the SSH connection should be the default.</p>
<p>We run the following commands respectively with a root user or a user with sudo authority.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>1<span style="color:#f92672">]</span> rm /etc/ssh/ssh_host_*
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">]</span> ssh-keygen -t rsa -b <span style="color:#ae81ff">4096</span> -f /etc/ssh/ssh_host_rsa_key -N <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>3<span style="color:#f92672">]</span> ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>4<span style="color:#f92672">]</span> awk <span style="color:#e6db74">&#39;$5 &gt;= 3072&#39;</span> /etc/ssh/moduli &gt; /etc/ssh/moduli.tmp
</span></span><span style="display:flex;"><span>5<span style="color:#f92672">]</span> mv /etc/ssh/moduli.tmp /etc/ssh/moduli
</span></span><span style="display:flex;"><span>6<span style="color:#f92672">]</span> sed -i <span style="color:#e6db74">&#39;s/^\#HostKey \/etc\/ssh\/ssh_host_\(rsa\|ed25519\)_key$/HostKey \/etc\/ssh\/ssh_host_\1_key/g&#39;</span> /etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>7<span style="color:#f92672">]</span> echo -e <span style="color:#e6db74">&#34;KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\nMACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\nHostKeyAlgorithms ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com&#34;</span> &gt; /etc/ssh/sshd_config.d/ssh-hardening.conf
</span></span></code></pre></div><p>After making the settings, apply the settings with the command &ldquo;sudo sshd -t&rdquo; and then, if you do not see an error message, &ldquo;sudo service sshd restart&rdquo; and restart the service. Now you will be able to connect to the server via the port you have just defined and only with your private key. To connect;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>You can use the command ssh -i ~/.ssh/KEY_NAME USER_NAME@SERVER_IP_ADRESS -p PORT_NUMBER #. You can continue by saying Enter to the incoming notifications.
</span></span></code></pre></div><h1 id="end">End</h1>
<p>This article was previously published at <a href="https://teknolojirehberleri.xyz">https://teknolojirehberleri.xyz</a>. In order to create a personal portfolio, I felt the need to republish it on my personal site.</p>
]]></content:encoded></item></channel></rss>