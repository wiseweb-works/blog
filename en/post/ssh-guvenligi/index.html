<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Increasing SSH security on Linux Servers | Wise</title><meta name=keywords content="linux,ssh,security,audit"><meta name=description content="Increasing SSH security on Linux Servers Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem."><meta name=author content="Wise"><link rel=canonical href=https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.1dc5045524874cb6405eec9368359dbbf2b48c56f110d6815cb53713394d9397.css integrity="sha256-HcUEVSSHTLZAXuyTaDWdu/K0jFbxENaBXLU3EzlNk5c=" rel="preload stylesheet" as=style><link rel=icon href=https://wiseweb-works.github.io/blog/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wiseweb-works.github.io/blog/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wiseweb-works.github.io/blog/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://wiseweb-works.github.io/blog/favicons/apple-touch-icon.png><link rel=mask-icon href=https://wiseweb-works.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=tr href=https://wiseweb-works.github.io/blog/post/ssh-guvenligi/><link rel=alternate hreflang=en href=https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/><link rel=alternate hreflang=de href=https://wiseweb-works.github.io/blog/de/post/ssh-guvenligi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Increasing SSH security on Linux Servers"><meta property="og:description" content="Increasing SSH security on Linux Servers Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem."><meta property="og:type" content="article"><meta property="og:url" content="https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-10-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-07T05:02:05+02:00"><meta property="og:site_name" content="Wise Web Works"><meta name=twitter:card content="summary"><meta name=twitter:title content="Increasing SSH security on Linux Servers"><meta name=twitter:description content="Increasing SSH security on Linux Servers Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wiseweb-works.github.io/blog/en/post/"},{"@type":"ListItem","position":2,"name":"Increasing SSH security on Linux Servers","item":"https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Increasing SSH security on Linux Servers","name":"Increasing SSH security on Linux Servers","description":"Increasing SSH security on Linux Servers Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem.","keywords":["linux","ssh","security","audit"],"articleBody":"Increasing SSH security on Linux Servers Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem.\nSimple Safety Precautions First, we need to install the updates via the console with the package manager of the Linux version we are in.\nUbuntu: sudo apt update \u0026\u0026 sudo apt upgrade -y Fedora: sudo yum update -y Arch Linux: sudo pacman -Syyu After the updates are installed, we start configuring the SSHD service (which is the service that allows you to receive ssh connections from outside) on your server (Ubuntu in my case). Foremost, due to the confusion, it should be noted that the ssh service and the SSHD service are different services. While the SSH service is the service that connects the server to other computers or servers, the SSHD service is the service that allows other computers to connect to your server, that is, incoming connections.\nThe file that keeps the settings of the SSHD service is generally located at ‚Äú/etc/ssh/sshd_config‚Äù. We need to open it with any of the text editors we use, but with a user with sudo (ie administrator) privileges.\nIf we continue on, Ubuntu\nsudo nano /etc/ssh/sshd_config # Command to open the settings file Titles we will find and replace\n#ClientAliveInterval 0 \u003e\u003e We remove the hashtag at the beginning and change the value from \"0\" to 300. This command regulates the automatic closing of the connection after how many seconds when the connection is not used (it stays in the idle position). #PermitEmptyPasswords no \u003e\u003e¬†We remove the hashtag at the beginning and do not change the \"no\" value. This command prevents blank or unencrypted users from connecting. So it doesn't allow empty passwords. X11Forwarding yes \u003e\u003e If there is a hashtag at the beginning, we remove it, otherwise we change the \"yes\" value to no. Although this command provides ease of running applications with GUI interface on the server, we close it because it is possible to abuse it. #MaxAuthTries 6 \u003e\u003e We remove the hashtag at the beginning and change the value from \"6\" to 3. This command regulates how many times they can try your password. The number 6 is an unnecessarily high value and the general acceptance is 3 or 4. #Protocol 2 \u003e\u003e If there is a hashtag at the beginning, we remove it, if there is no such record, we add the value in the form of \"Protocol 2\" to the first space we find. This command ensures that connections are made only with the latest SSH protocol, protecting you from vulnerabilities of the old protocol. If you want to check after making the settings: You can use the command ‚Äúsudo sshd -t‚Äù. If you do not see an error message, you can apply the settings and restart the service with the command ‚Äúsudo systemctl restart sshd‚Äù or ‚Äúsudo service sshd restart‚Äù\nRecommended settings In addition to the previous settings, we will make additional settings such as user-based login, login using only secure key and restrict login with Root user. First you need to generate a secret key for your user on your local computer. For this, if you are using a linux-based operating system\nAfter typing ssh-keygen -t rsa -b 4096 #, enter the password you want in response to the questions below \u003e\u003e\u003e\u003e Enter passphrase (empty for no passphrase): [Press enter key] \u003e\u003e\u003e\u003e Enter same passphrase again: [Press enter key] or ssh-keygen -t ecdsa -b 521 # Generates more secure and faster ecliptic key. Enter the password you want in response to the questions below \u003e\u003e\u003e\u003e Enter passphrase (empty for no passphrase): [Press enter key] \u003e\u003e\u003e\u003e Enter same passphrase again: [Press enter key] If you answered other questions by pressing Enter and did not type a specific location for the key, your key pair (.pub= public key) / private key without extension) is saved in the /home/USER_NAME/.ssh folder. You can use the code below to introduce the key you generated to your server.\nssh-copy-id -i ~/.ssh/KEY_NAME.pub After typing USER_NAME@SERVER_IP_ADRESS # on the SERVER, it will ask for your user's password and if you enter it correctly, you will see a confirmation message. After generating your own key, to access the server only with the key; Titles we will find and replace\n#PasswordAuthentication no \u003e\u003e We remove the hashtag at the beginning and leave the \"no\" value as no. This command prevents connecting to the server with a password. Users can only connect with ssh_keys. PubkeyAuthentication yes \u003e\u003e¬†If there is, we remove the hash mark at the beginning and set the value as yes. This command is the command that allows you to log in with the secret key you just created. #PermitRootLogin no \u003e\u003e We remove the hashtag at the beginning and leave the \"no\" value as no. This command prevents the ROOT user, who is the most authorized user, from accessing the server. However, you can access it with another user and then switch to the ROOT user. AllowUsers YOUR USERNAME \u003e\u003e¬†If it doesn't exist, we add such a record. It prevents other users from connecting to the server and/or attempting a username. LoginGraceTime 20 \u003e\u003e If not, we add such a record and set the value to 20. Determines the time required to log in, in seconds. We prevent them from keeping the server busy with a long login request. ChallengeResponseAuthentication no \u003e\u003e¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods. KerberosAuthentication no \u003e\u003e¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods. GSSAPIAuthentication no \u003e\u003e¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods. If you want to check after making the settings: You can use the command ‚Äúsudo sshd -t‚Äù. If you do not see an error message, you can apply the settings and restart the service with the command ‚Äúsudo systemctl restart sshd‚Äù or ‚Äúsudo service sshd restart‚Äù\nAdvanced Settings First of all, we will change the standard SSH connection port, 22, and then make the encryption tools used during SSH connection even stronger. Then we will determine how the logs (registry records) of the server SSH service are kept.\nTitles we will find and replace\n#Port 22 \u003e\u003e We find this and remove the hash mark at the beginning and write there a port number that is not used by any other service and is open. For example, it could be 2992. LogLevel INFO \u003e\u003e¬†We find this setting and change it, if not, we add it. It helps us to set the recording level. AllowAgentForwarding no \u003e\u003e¬†We find this setting and change it, if not, we add it. Disables alternative routing methods. AllowTcpForwarding no \u003e\u003e¬†We find this setting and change it, if not, we add it. Disables alternative routing methods. PrintMotd no \u003e\u003e¬†We find this setting and change it, if not, we add it. To prevent them from knowing about the server before the connection is established. PermitUserEnvironment no \u003e\u003e¬†We find this setting and change it, if not, we add it. PermitTunnel no \u003e\u003e¬†We find this setting and change it, if not, we add it. We go further and determine which of the encryption algorithms, authentication algorithms, key exchange algorithms and other algorithms used during the SSH connection should be the default.\nWe run the following commands respectively with a root user or a user with sudo authority.\n1] rm /etc/ssh/ssh_host_* 2] ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N \"\" 3] ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N \"\" 4] awk '$5 \u003e= 3072' /etc/ssh/moduli \u003e /etc/ssh/moduli.tmp 5] mv /etc/ssh/moduli.tmp /etc/ssh/moduli 6] sed -i 's/^\\#HostKey \\/etc\\/ssh\\/ssh_host_\\(rsa\\|ed25519\\)_key$/HostKey \\/etc\\/ssh\\/ssh_host_\\1_key/g' /etc/ssh/sshd_config 7] echo -e \"KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\\nMACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\\nHostKeyAlgorithms ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com\" \u003e /etc/ssh/sshd_config.d/ssh-hardening.conf After making the settings, apply the settings with the command ‚Äúsudo sshd -t‚Äù and then, if you do not see an error message, ‚Äúsudo service sshd restart‚Äù and restart the service. Now you will be able to connect to the server via the port you have just defined and only with your private key. To connect;\nYou can use the command ssh -i ~/.ssh/KEY_NAME USER_NAME@SERVER_IP_ADRESS -p PORT_NUMBER #. You can continue by saying Enter to the incoming notifications. End This article was previously published at https://teknolojirehberleri.xyz. In order to create a personal portfolio, I felt the need to republish it on my personal site.\n","wordCount":"1475","inLanguage":"en","datePublished":"2021-10-05T00:00:00Z","dateModified":"2023-04-07T05:02:05+02:00","author":{"@type":"Person","name":"Wise"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wiseweb-works.github.io/blog/en/post/ssh-guvenligi/"},"publisher":{"@type":"Organization","name":"Wise","logo":{"@type":"ImageObject","url":"https://wiseweb-works.github.io/blog/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wiseweb-works.github.io/blog/en/ accesskey=h title="Wise (Alt + H)">Wise</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://wiseweb-works.github.io/blog/ title=Turkish aria-label=:tr:>üáπüá∑</a></li><li><a href=https://wiseweb-works.github.io/blog/de/ title=Deutsch aria-label=:de:>üá©üá™</a></li></ul></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Increasing SSH security on Linux Servers</h1><div class=post-meta><span title='2021-10-05 00:00:00 +0000 UTC'>5 October, 2021</span>&nbsp;¬∑&nbsp;<span title='2023-04-07 05:02:05 +0200 +0200'>(Updated 7 April, 2023)</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;1475 words&nbsp;¬∑&nbsp;Wise&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://wiseweb-works.github.io/blog/post/ssh-guvenligi/>üáπüá∑</a></li><li><a href=https://wiseweb-works.github.io/blog/de/post/ssh-guvenligi/>üá©üá™</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/wiseweb-works/blog/tree/master/content/post/ssh-guvenligi.en.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#increasing-ssh-security-on-linux-servers aria-label="Increasing SSH security on Linux Servers">Increasing SSH security on Linux Servers</a><ul><li><a href=#simple-safety-precautions aria-label="Simple Safety Precautions">Simple Safety Precautions</a></li><li><a href=#recommended-settings aria-label="Recommended settings">Recommended settings</a></li><li><a href=#advanced-settings aria-label="Advanced Settings">Advanced Settings</a></li></ul></li><li><a href=#end aria-label=End>End</a></li></ul></div></details></div><div class=post-content><h1 id=increasing-ssh-security-on-linux-servers>Increasing SSH security on Linux Servers<a hidden class=anchor aria-hidden=true href=#increasing-ssh-security-on-linux-servers>#</a></h1><p>Today, I will talk about how we can keep the SSH service, which allows us to connect securely when you rent a server, more secure and away from malicious requests from outside. Foremost, I will describe the process under three different headings: simple, recommended and advanced. Title contents are gradually considered according to personal requirements. Although the titles are linked to each other, leaving them at a desired stage will not pose a problem.</p><h2 id=simple-safety-precautions>Simple Safety Precautions<a hidden class=anchor aria-hidden=true href=#simple-safety-precautions>#</a></h2><p>First, we need to install the updates via the console with the package manager of the Linux version we are in.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Ubuntu: sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Fedora: sudo yum update -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Arch Linux: sudo pacman -Syyu
</span></span></code></pre></div><p>After the updates are installed, we start configuring the SSHD service (which is the service that allows you to receive ssh connections from outside) on your server (Ubuntu in my case). Foremost, due to the confusion, it should be noted that the ssh service and the SSHD service are different services. While the SSH service is the service that connects the server to other computers or servers, the SSHD service is the service that allows other computers to connect to your server, that is, incoming connections.</p><p>The file that keeps the settings of the SSHD service is generally located at ‚Äú/etc/ssh/sshd_config‚Äù. We need to open it with any of the text editors we use, but with a user with sudo (ie administrator) privileges.</p><p>If we continue on, Ubuntu</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/ssh/sshd_config <span style=color:#75715e># Command to open the settings file</span>
</span></span></code></pre></div><p>Titles we will find and replace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>#ClientAliveInterval 0 &gt;&gt; We remove the hashtag at the beginning and change the value from &#34;0&#34; to 300. This command regulates the automatic closing of the connection after how many seconds when the connection is not used (it stays in the idle position).
</span></span><span style=display:flex><span>#PermitEmptyPasswords no &gt;&gt;¬†We remove the hashtag at the beginning and do not change the &#34;no&#34; value. This command prevents blank or unencrypted users from connecting. So it doesn&#39;t allow empty passwords.
</span></span><span style=display:flex><span>X11Forwarding yes &gt;&gt; If there is a hashtag at the beginning, we remove it, otherwise we change the &#34;yes&#34; value to no. Although this command provides ease of running applications with GUI interface on the server, we close it because it is possible to abuse it.
</span></span><span style=display:flex><span>#MaxAuthTries 6 &gt;&gt; We remove the hashtag at the beginning and change the value from &#34;6&#34; to 3. This command regulates how many times they can try your password. The number 6 is an unnecessarily high value and the general acceptance is 3 or 4.
</span></span><span style=display:flex><span>#Protocol 2 &gt;&gt; If there is a hashtag at the beginning, we remove it, if there is no such record, we add the value in the form of &#34;Protocol 2&#34; to the first space we find. This command ensures that connections are made only with the latest SSH protocol, protecting you from vulnerabilities of the old protocol.
</span></span></code></pre></div><p>If you want to check after making the settings: You can use the command &ldquo;sudo sshd -t&rdquo;. If you do not see an error message, you can apply the settings and restart the service with the command &ldquo;sudo systemctl restart sshd&rdquo; or &ldquo;sudo service sshd restart&rdquo;</p><h2 id=recommended-settings>Recommended settings<a hidden class=anchor aria-hidden=true href=#recommended-settings>#</a></h2><p>In addition to the previous settings, we will make additional settings such as user-based login, login using only secure key and restrict login with Root user. First you need to generate a secret key for your user on your local computer. For this, if you are using a linux-based operating system</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>After typing ssh-keygen -t rsa -b 4096 #, enter the password you want in response to the questions below
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt; Enter passphrase (empty for no passphrase): [Press enter key]
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt; Enter same passphrase again: [Press enter key]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>or
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssh-keygen -t ecdsa -b 521 # Generates more secure and faster ecliptic key. Enter the password you want in response to the questions below
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt; Enter passphrase (empty for no passphrase): [Press enter key]
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt; Enter same passphrase again: [Press enter key]
</span></span></code></pre></div><p>If you answered other questions by pressing Enter and did not type a specific location for the key, your key pair (.pub= public key) / private key without extension) is saved in the /home/USER_NAME/.ssh folder. You can use the code below to introduce the key you generated to your server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ssh-copy-id -i ~/.ssh/KEY_NAME.pub After typing USER_NAME@SERVER_IP_ADRESS # on the SERVER, it will ask for your user&#39;s password and if you enter it correctly, you will see a confirmation message.
</span></span></code></pre></div><p>After generating your own key, to access the server only with the key;
Titles we will find and replace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>#PasswordAuthentication no &gt;&gt; We remove the hashtag at the beginning and leave the &#34;no&#34; value as no. This command prevents connecting to the server with a password. Users can only connect with ssh_keys.
</span></span><span style=display:flex><span>PubkeyAuthentication yes &gt;&gt;¬†If there is, we remove the hash mark at the beginning and set the value as yes. This command is the command that allows you to log in with the secret key you just created.
</span></span><span style=display:flex><span>#PermitRootLogin no &gt;&gt; We remove the hashtag at the beginning and leave the &#34;no&#34; value as no. This command prevents the ROOT user, who is the most authorized user, from accessing the server. However, you can access it with another user and then switch to the ROOT user.
</span></span><span style=display:flex><span>AllowUsers YOUR USERNAME &gt;&gt;¬†If it doesn&#39;t exist, we add such a record. It prevents other users from connecting to the server and/or attempting a username.
</span></span><span style=display:flex><span>LoginGraceTime 20 &gt;&gt; If not, we add such a record and set the value to 20. Determines the time required to log in, in seconds. We prevent them from keeping the server busy with a long login request.
</span></span><span style=display:flex><span>ChallengeResponseAuthentication no &gt;&gt;¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span><span style=display:flex><span>KerberosAuthentication no &gt;&gt;¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span><span style=display:flex><span>GSSAPIAuthentication no &gt;&gt;¬†If there is, we remove the hash mark at the beginning and set the value as no. This command disables other login methods.
</span></span></code></pre></div><p>If you want to check after making the settings: You can use the command &ldquo;sudo sshd -t&rdquo;. If you do not see an error message, you can apply the settings and restart the service with the command &ldquo;sudo systemctl restart sshd&rdquo; or &ldquo;sudo service sshd restart&rdquo;</p><h2 id=advanced-settings>Advanced Settings<a hidden class=anchor aria-hidden=true href=#advanced-settings>#</a></h2><p>First of all, we will change the standard SSH connection port, 22, and then make the encryption tools used during SSH connection even stronger. Then we will determine how the logs (registry records) of the server SSH service are kept.</p><p>Titles we will find and replace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>#Port 22 &gt;&gt; We find this and remove the hash mark at the beginning and write there a port number that is not used by any other service and is open. For example, it could be 2992.
</span></span><span style=display:flex><span>LogLevel INFO &gt;&gt;¬†We find this setting and change it, if not, we add it. It helps us to set the recording level.
</span></span><span style=display:flex><span>AllowAgentForwarding no &gt;&gt;¬†We find this setting and change it, if not, we add it. Disables alternative routing methods.
</span></span><span style=display:flex><span>AllowTcpForwarding no &gt;&gt;¬†We find this setting and change it, if not, we add it. Disables alternative routing methods.
</span></span><span style=display:flex><span>PrintMotd no &gt;&gt;¬†We find this setting and change it, if not, we add it. To prevent them from knowing about the server before the connection is established.
</span></span><span style=display:flex><span>PermitUserEnvironment no &gt;&gt;¬†We find this setting and change it, if not, we add it.
</span></span><span style=display:flex><span>PermitTunnel no &gt;&gt;¬†We find this setting and change it, if not, we add it.
</span></span></code></pre></div><p>We go further and determine which of the encryption algorithms, authentication algorithms, key exchange algorithms and other algorithms used during the SSH connection should be the default.</p><p>We run the following commands respectively with a root user or a user with sudo authority.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>1<span style=color:#f92672>]</span> rm /etc/ssh/ssh_host_*
</span></span><span style=display:flex><span>2<span style=color:#f92672>]</span> ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -f /etc/ssh/ssh_host_rsa_key -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>3<span style=color:#f92672>]</span> ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>4<span style=color:#f92672>]</span> awk <span style=color:#e6db74>&#39;$5 &gt;= 3072&#39;</span> /etc/ssh/moduli &gt; /etc/ssh/moduli.tmp
</span></span><span style=display:flex><span>5<span style=color:#f92672>]</span> mv /etc/ssh/moduli.tmp /etc/ssh/moduli
</span></span><span style=display:flex><span>6<span style=color:#f92672>]</span> sed -i <span style=color:#e6db74>&#39;s/^\#HostKey \/etc\/ssh\/ssh_host_\(rsa\|ed25519\)_key$/HostKey \/etc\/ssh\/ssh_host_\1_key/g&#39;</span> /etc/ssh/sshd_config
</span></span><span style=display:flex><span>7<span style=color:#f92672>]</span> echo -e <span style=color:#e6db74>&#34;KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\nMACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\nHostKeyAlgorithms ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com&#34;</span> &gt; /etc/ssh/sshd_config.d/ssh-hardening.conf
</span></span></code></pre></div><p>After making the settings, apply the settings with the command &ldquo;sudo sshd -t&rdquo; and then, if you do not see an error message, &ldquo;sudo service sshd restart&rdquo; and restart the service. Now you will be able to connect to the server via the port you have just defined and only with your private key. To connect;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>You can use the command ssh -i ~/.ssh/KEY_NAME USER_NAME@SERVER_IP_ADRESS -p PORT_NUMBER #. You can continue by saying Enter to the incoming notifications.
</span></span></code></pre></div><h1 id=end>End<a hidden class=anchor aria-hidden=true href=#end>#</a></h1><p>This article was previously published at <a href=https://teknolojirehberleri.xyz>https://teknolojirehberleri.xyz</a>. In order to create a personal portfolio, I felt the need to republish it on my personal site.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wiseweb-works.github.io/blog/en/tags/linux/>linux</a></li><li><a href=https://wiseweb-works.github.io/blog/en/tags/ssh/>ssh</a></li><li><a href=https://wiseweb-works.github.io/blog/en/tags/security/>security</a></li><li><a href=https://wiseweb-works.github.io/blog/en/tags/audit/>audit</a></li></ul><nav class=paginav><a class=prev href=https://wiseweb-works.github.io/blog/en/post/ssl-konfigurasyonu/><span class=title>¬´ Prev</span><br><span>Increasing SSL security on Linux Servers</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://wiseweb-works.github.io/blog/en/>Wise</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>