<!doctype html><html lang=tr dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux Sunucularda SSL güvenliğini arttırma | Wise</title><meta name=keywords content="linux,ssl,security,audit"><meta name=description content="Linux Sunucularda SSL güvenliğini artırma Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS&rsquo;ye bırakmıştır."><meta name=author content="Wise"><link rel=canonical href=https://wiseweb-works.github.io/blog/post/ssl-konfigurasyonu/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.3da8f760c1219bf0b204073b46d591a809f88d454cd18abfeec1ca847f7b86a1.css integrity="sha256-Paj3YMEhm/CyBAc7RtWRqAn4jUVM0Yq/7sHKhH97hqE=" rel="preload stylesheet" as=style><link rel=icon href=https://wiseweb-works.github.io/blog/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wiseweb-works.github.io/blog/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wiseweb-works.github.io/blog/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://wiseweb-works.github.io/blog/favicons/apple-touch-icon.png><link rel=mask-icon href=https://wiseweb-works.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=tr href=https://wiseweb-works.github.io/blog/post/ssl-konfigurasyonu/><link rel=alternate hreflang=en href=https://wiseweb-works.github.io/blog/en/post/ssl-konfigurasyonu/><link rel=alternate hreflang=de href=https://wiseweb-works.github.io/blog/de/post/ssl-konfigurasyonu/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Linux Sunucularda SSL güvenliğini arttırma"><meta property="og:description" content="Linux Sunucularda SSL güvenliğini artırma Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS&rsquo;ye bırakmıştır."><meta property="og:type" content="article"><meta property="og:url" content="https://wiseweb-works.github.io/blog/post/ssl-konfigurasyonu/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-10-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-08T02:13:24+02:00"><meta property="og:site_name" content="Wise Web Works"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Sunucularda SSL güvenliğini arttırma"><meta name=twitter:description content="Linux Sunucularda SSL güvenliğini artırma Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS&rsquo;ye bırakmıştır."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wiseweb-works.github.io/blog/post/"},{"@type":"ListItem","position":2,"name":"Linux Sunucularda SSL güvenliğini arttırma","item":"https://wiseweb-works.github.io/blog/post/ssl-konfigurasyonu/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux Sunucularda SSL güvenliğini arttırma","name":"Linux Sunucularda SSL güvenliğini arttırma","description":"Linux Sunucularda SSL güvenliğini artırma Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS\u0026rsquo;ye bırakmıştır.","keywords":["linux","ssl","security","audit"],"articleBody":"Linux Sunucularda SSL güvenliğini artırma Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS’ye bırakmıştır. Fakat yine de işin anlatımı kısmında ve config dosyalarını düzenlerken halen “ssl” kelimesini kullanmamız gerekecektir. Bunu ufak bir espiri ile de anlatmak gerekirse eğer bir uygulamanın 64 bit versiyonunu indirmek istediğiniz aman “amd_64” olarak neden geçtiğini hiç düşündünüz mü? Çünkü 64 bit’e ilk geçen AMD olduğu için buna bir saygı göstergesi ve/veya alışkanlık olarak amd_64 olarak kaldı bu isimlendirme. Aynı şekilde de şu an TLS kullanıyor olmamıza rağmen isimlendirme ve konfigürasyon parametreleri “SSL” olarak kaldı.\nDaha önceki yazımızda olduğu gibi süreci yine basit, önerilen ve ileri-seviye olarak üç farklı başlık altında anlatacağım. Başlık içerikleri kişisel gerekliliklere göre aşamalı düşünülmüştür. Başlıklar bir biri ile bağlantılı olmasına rağmen istenilen bir aşamada bırakılması sorun oluşturmayacaktır.\nBasit konfigürasyon Öncelikle içinde bulunduğumuz Linux sürümünün paket yöneticisi ile güncellemeleri konsol üzerinden yüklememiz gerekmektedir.\nUbuntu için: sudo apt update \u0026\u0026 sudo apt upgrade -y Fedora için: sudo yum update -y Arch Linux için: sudo pacman -Syyu Güncellemeler yüklendikten sonra ise sunucunuzdaki (Benim olayımda Ubuntu) nginx/apache servisini (ki bu servis dışarıdan gelen web bağlantılarını almanıza yarayan servistir) yapılandırmaya başlıyoruz. Nginx servisinin ayarlarının tutulduğu dosya genel itibariyle “/etc/nginx/nginx.conf” konumunda bulunur. Bunu kendi kullandığımız metin editörlerinden istediğimiz biriyle ama sudo (yani yönetici) yetkilerine sahip bir kullanıcı ile açmamız gerekmektedir.\nUbuntu üzerinden devam edecek olursak (Tek Ip Tek Sunucu Yapılandırması)\nsudo nano /etc/nginx/nginx.config # Ayar dosyasını açmaya yarayan komut Eklenecek (varsa değiştirilecek) başlıklar listen 443 ssl http2; \u003e\u003e ipv4 üzerinden 443 portuna gelen istekleri http2 protokolü ile karşılayıp ssl bağlantısı kurmaya yarıyor. listen [::]:443 ssl http2; \u003e\u003e ipv6 üzerinden 443 portuna gelen istekleri http2 protokolü ile karşılayıp ssl bağlantısı kurmaya yarıyor. (Eğer ipv6 desteğiniz yok ise veya native olarak desteklemek istemiyorsanız kaldırabilirsiniz) server_name SUNUCU_ADINIZ; \u003e\u003e Eğer sunucu adınızı default olarak belirlemek istemiyorsanız bir Server Name Indicator belirleyebilirsiniz. Bu gelen tüm istekleri karşılamak yerine sadece sunucu adınıza gelen istekleri karşılamaya yarar. ssl_certificate /etc/letsencrypt/live/SUNUCU_ADINIZ/fullchain.pem; \u003e\u003e Eğer free ssl için Let's Encrypt kullanıyor iseniz default sertifika konumu burasıdır. Aksi halde kendi sertifika dosyanız ile değiştirin. ssl_certificate_key /etc/letsencrypt/live/SUNUCU_ADINIZ/privkey.pem; \u003e\u003e Eğer free ssl için Let's Encrypt kullanıyor iseniz default private key konumu burasıdır. Aksi halde kendi private key dosya konumunuz ile değiştirin. ssl_protocols TLSv1.3 TLSv1.2; \u003e\u003e Sadece en güncel ve en güvenilir TLS protokollerini kabul etmek için gerekli komut. ssl_prefer_server_ciphers on; \u003e\u003e Sunucu ile istemcinin konuşması sırasında \"tamam nelerimiz var bakalım\" diye konuştuklarını tahmin ettiğim :D kısımda sunucunun sadece kendi seçtiği şifreleme algoritmaları ile bu görüşmeyi devam ettireceğini söylemesine yarayan komut. Kısacası işine gelirse böyle işine gelmezse konuşmuyorum. ssl_ecdh_curve secp521r1:secp384r1; \u003e\u003e Ekliptik eğrileri kullanmamız gereken durumlarda hangi eğrileri tercih ettiğimizi bildiren komuttur. ssl_ciphers DH-RSA-AES256-SHA:DH-RSA-AES256-SHA256:DHE-RSA-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDH-ECDSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDH-RSA-AES256-SHA:AECDH-AES256-SHA:ECDHE-ECDSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:ECDH-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDH-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-CCM:DHE-RSA-AES256-CCM8:ECDHE-ECDSA-AES256-CCM:ECDHE-ECDSA-AES256-CCM8:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305; \u003e\u003e En güvenilir bulduğum SSL algoritmalarının bir araya getirilerek sadece bunları kullanmasını sunucuya söyleyen kod. Tek tek araştırmak isteyenler için tüm cipherlar: “https://testssl.sh/openssl-iana.mapping.html\"\nAyarları yaptıktan sonra kontrol etmek isterseniz: “sudo nginx -t” komutunu kullanabilirsiniz. Eğer bir hata mesajı görmez iseniz “sudo systemctl restart nginx” veya “sudo service nginx restart” komutu ile ayarları uygulayıp servisi baştan başlatabilirsiniz\nÖnerilen ayarlar Bir önceki ayarlara ek olarak performans özelinde bazı iyileştirmeler ve bunun yanı sıra sitenizin SSL test sitelerinde üst sıralara çıkmasını sağlayacak bazı ek konfigürasyonlar yapacağız. Bunun ardından ise sitenizin kullanıcı ile erişiminde faydalı olarak bazı başlıkları (header) ve sitenizin kaynaklarının üçüncü kişi siteler tarafından sömürülmemesi için bir takım iyileştirmeler yapacağız.\nEklenecek (varsa değiştirilecek) başlıklar ssl_session_cache shared:TLS:2m; \u003e\u003e TLS bağlantılarının işçiler (nginx workers) arasında nasıl dağıtılacağını ve ne kadar süre ile bağlantıların ortak kullanılacağını belirten kod ssl_buffer_size 4k; \u003e\u003e SSL isteklerine cevap verirken ve handshake sonrası paket gönderimi yaparken paketlerin kaçlık konteynırlara bölüneceğini belirten kod. Daha düşük bir değer daha çok paket gönderilmesi ama daha az taşma (overhead) anlamına gelir. ssl_stapling on; \u003e\u003e OCSP zımbalama özelliğini aktif hale getirir ssl_stapling_verify on; OCSP zımbalamanın üst ve kök sunucularda dahil olmak üzere doğrulanması özelliğini açar. resolver 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001; \u003e\u003e Cloudlfare ile OCSP zımbalama doğrulamasının yapılmasını sağlar. Eğer IPV6 kullanmıyor veya native olarak desteklemek istemiyorsanız ipv6 adreslerini silebilirsiniz. add_header X-Content-Type-Options \"nosniff\" always; \u003e\u003e Tarayıcıların MIME içeriklerini anlamak için koklama (sniff) yapmasını engeleyen başlık değeridir. add_header X-Xss-Protection \"1; mode=block\" always; \u003e\u003e Olası bir XSS açığında kullanıcıların beyaz ekran görmesini sağlayarak açığı bir nebze de olsa engelleyen bir başlıktır. add_header X-Frame-Options \"SAMEORIGIN\" always; \u003e\u003e Herhangi bir şekilde i-frame vb bir kod ile sunucunuzun bir sayfasının başka bir sayfada gösterilmesini ve/veya alt-alta üst-üste yayımlanmasını engeller. Sadece siz kendi siteniz içerisinde kendi sitenizden bir pencere yayımlayabilirsiniz. add_header Referrer-Policy \"no-referrer-when-downgrade\" always; \u003e\u003e Daha alt güvenlik önlemine sahip bir siteye yönlendirme veya link verdiğinizde otomatik olarak referrer başlığı eklemez ve sitenizden trafik geldiği belli olmaz. add_header Content-Security-Policy \"default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval';\" always; \u003e\u003e Sizin ve diğer kullanıcıların dışarıdan çağırabilecekleri isteklerin hangi koşullar altında çağrılabileceğini düzenleyen başlık. Ben default olarak https üzerinden gelen bazı kaynaklara güveniyorum. add_header Permissions-Policy \"camera=(), fullscreen=(self), geolocation=(), microphone=(), payment=()\" always; \u003e\u003e Tarayıcıya hangi izinleri isteyeceğinizi veya hangilerine hiç ihtiyacınız olmayacağını belirterek çeşitli zehirleme türleri (cache-poisoning veya js-poisoning) ile sizin siteniz üzerinden bilgi toplanmasını engeller. Ayarları yaptıktan sonra kontrol etmek isterseniz: “sudo nginx -t” komutunu kullanabilirsiniz. Eğer bir hata mesajı görmez iseniz “sudo systemctl restart nginx” veya “sudo service nginx restart” komutu ile ayarları uygulayıp servisi baştan başlatabilirsiniz.\nİleri Seviye Ayarlar Öncelikle sitenize sadece ssl üzerinden bağlanması gerektiğini gösterecek bir başlık ekleyeceğiz. Bu sayede sizin sitenize daha önce girmiş olanlar ve hali hazırda bu başlığı tarayıcısında mevcut olanlar istese bile sizin sitenize Non-SSL şekilde erişemeyecekler. Ardından ise HTTP oturumlarına kullanılması gereken SSL sertifikalarını zımbalayacağız ve önceki yöntemin yanından hangi sertifikalar ile bağlanması gerekeceğini de önceden belirtmiş olacağız. Bu sayede yetkili bir üst sertifika yöneticisi veya kök yöneticisi olsanız dahi sizin adınıza imzaladığı sertifika ile sizin sitenize bağlanamayacaklar. Zamaında Türkiyede yerleşik E-Tuğra Kök Sertifika sağlayıcısı *.google.com adresine bir sertifika imzaladı. Biraz araştırırsanız hangi dönemde meydana geldiğini ve nedenini (ne kadar kötü sonuçlara neden olabileceğini) fardekersiniz. Şimdi başlayalım son konfigürasyon kısmına.\nÖncelikle sitenizin SSL üzerinden hiçbir soruna neden olmaksızın erişilebiliyor olduğundan emin olun. Ardından nginx konfig dosyasına aşağıdaki başlıklardan isteğinize göre birini ekleyin. Ama dikkat edin sadece bir tanesini.\nadd_header Strict-Transport-Security \"max-age=2592000;\" always; \u003e\u003e Sitenize 30 gün boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık. (Alt alan adları dahil değil) add_header Strict-Transport-Security \"max-age=2592000; includeSubDomains;\" always; \u003e\u003e Sitenize alt alan adları da dahil olmak üzere 30 gün boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık. add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains;\" always; \u003e\u003e Sitenize alt alan adları da dahil olmak üzere 1 yıl boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık. add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always; \u003e\u003e Sitenize alt alan adları da dahil olmak üzere 1 yıl boyunca sadece HTTPS üzerinden erişilebileceğini ve bu başlığın tarayıcıların önbelleğine alınması talimatını veren başlık. Ayrıca yeni çıkan tarayıcılar sitenize daha önce hiç girmese dahi bu başlıktan haberdar olacaktır. add_header Strict-Transport-Security \"max-age=0; includeSubDomains\"; \u003e\u003e HSTS özelliğini ve preload listesi üyeliğini tamamen kaldırmaya yarayan başlık. Yukarıda belirtilen başlığı ekledikten sonra şimdi kullanmış olduğunuz ssl sertifikasının özetinin HTTP oturumuna zımbalanmasına geldi. Bu aşamada mevcut sertifikanızın bir özetini çıkarmamız, üst imzalayan yetkilinin sertifikasının özetini çıkarmamız ve en üst kök sertifika yetkilisi de dahil olmak üzere tüm zinciri tamamlayana kadar bu özet çıkarma sürecini devam ettirmemiz gerekiyor. Bu nedenle root kullanıcısı veya sudo yetkisine sahip bir kullanıcı ile aşağıdaki komutları sırasıyla çalıştırıyoruz. (Anlatım Let’s Encrypt özelinde yapılmıştır.)\n1] cat /etc/letsencrypt/live/SUNUCU_ADINIZ/cert.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 \u003e\u003e Bu komut sizin sitenize ait sertifikanın özetini çıkaracaktır. Sonuç değerini bir yere kopyalayın. 2] curl -s https://letsencrypt.org/certs/lets-encrypt-x4-cross-signed.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 \u003e\u003e Bu komut letsencrypt'e ait çoklu imzalı sertifikalardan bir tanesinin özetini çıkaracaktır. 3] curl -s https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 \u003e\u003e Bu komut letsencrypt'e ait çoklu imzalı sertifikalardan bir tanesinin özetini çıkaracaktır. 4] curl -s https://letsencrypt.org/certs/isrgrootx1.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 \u003e\u003e Bu komut letsencrypt'e ait kök (en üst) sertifikasının özetini çıkaracaktır. Nginx config dosyasına aşağıdaki değer eklenir 5] add_header Public-Key-Pins 'pin-sha256=\"ILK_SONUC\"; pin-sha256=\"IKINCI_SONUC\"; pin-sha256=\"UCUNCU_SONUC\"; pin-sha256=\"DORDUNCU_SONUC\"; max-age=2592000; includeSubDomains' always; \u003e\u003e Sitenize 30 gün boyunca sadece belirtilen sertifika ile bağlanılmasına izin verir. Max-age değerini isteğe bağlı olarak artırabilirsiniz. Sertifika geçerlilik süreniz 30 günden daha az kalmadan başlığı devredışı bırakmanız veya yeni sertifika edinmeniz ve beşinci değer olarak onu eklemeniz gerekmektedir. Bonus olarak sunucunuzun yapmasının çok uzun süreceği ama faydası çok olan bir komut daha göstermek istiyorum. 6] openssl dhparam -out /etc/nginx/dhparams.pem 4096 \u003e\u003e Bu komutu uygulaması 15dk ile 1 saat arasında sürebilir. İşlem bittikten sonra nginx konfig dosyasına aşağıdaki komutu eklemeniz gerekmektedir. ssl_dhparam /etc/nginx/dhparam.pem; \u003e\u003e Diffie-Hellman anahtar değişim algoritması sırasında kullanılacak değerleri default değerler dışında az önce oluşturduğumuz gizli değerler ile değiştirmeye yarayan komut. Ayarları yaptıktan sonra “sudo nginx -t” ve ardından eğer bir hata mesajı görmez iseniz “sudo service nginx restart” komutu ile ayarları uygulayıp servisi baştan başlatın. Artık sizin belirlediğiniz konfigürasyon ve şartlar ile bağlantı sağlanacaktır. Eğer öncesi/sonrası puanlama farkını görmek isterseniz aşağıdaki görsellere bakabilirsiniz veya kendi sitenizi “https://www.ssllabs.com/ssltest/index.html\" adresinden test edebilirsiniz.\nİLK HALİ SSL Labs test sonucu SON DURUM SSL Labs test sonucu Neden Cipher Strength %100 değil derseniz TLS 1.3 ile otomatik gelen ve biz istemesek de eklenen “TLS_AES_128_GCM_SHA256 (0x1301)” yüzünden şu an %100 yapmak mümkün değil. TLS 1.3’ü kapatırım o zaman gelmez diye düşünürseniz o zaman da başka yerden puanınız gidiyor maalesef.\nSon Bu yazı daha önce https://teknolojirehberleri.xyz adresinde yayımlanmıştır. Kişisel portfolyo oluşturmak adına şahsi sitemde yeniden yayımlama ihtiyacı hissettim.\n","wordCount":"1616","inLanguage":"tr","datePublished":"2021-10-12T00:00:00Z","dateModified":"2023-04-08T02:13:24+02:00","author":{"@type":"Person","name":"Wise"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wiseweb-works.github.io/blog/post/ssl-konfigurasyonu/"},"publisher":{"@type":"Organization","name":"Wise","logo":{"@type":"ImageObject","url":"https://wiseweb-works.github.io/blog/favicons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wiseweb-works.github.io/blog/ accesskey=h title="Wise (Alt + H)">Wise</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://wiseweb-works.github.io/blog/en/ title=English aria-label=:gb:>🇬🇧</a></li><li><a href=https://wiseweb-works.github.io/blog/de/ title=Deutsch aria-label=:de:>🇩🇪</a></li></ul></div></div><ul id=menu><li><a href=https://wiseweb-works.github.io/blog/ title=Anasayfa><span>Anasayfa</span></a></li><li><a href=https://wiseweb-works.github.io/blog/post/ title=Blog><span>Blog</span></a></li><li><a href=https://wiseweb-works.github.io/blog/page/iletisim/ title=İletişim><span>İletişim</span></a></li><li><a href=https://wiseweb-works.github.io/blog/tags/ title=Etiketler><span>Etiketler</span></a></li><li><a href=https://wiseweb-works.github.io/blog/archives/ title=Arşiv><span>Arşiv</span></a></li><li><a href=https://wiseweb-works.github.io/blog/search/ title="Ara 🔍"><span>Ara 🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Linux Sunucularda SSL güvenliğini arttırma</h1><div class=post-meta><span title='2021-10-12 00:00:00 +0000 UTC'>12 Ekim, 2021</span>&nbsp;·&nbsp;<span title='2023-04-08 02:13:24 +0200 +0200'>(Updated 8 Nisan, 2023)</span>&nbsp;·&nbsp;8 dk&nbsp;·&nbsp;1616 kelime&nbsp;·&nbsp;Wise&nbsp;|&nbsp;Çeviriler:<ul class=i18n_list><li><a href=https://wiseweb-works.github.io/blog/en/post/ssl-konfigurasyonu/>🇬🇧</a></li><li><a href=https://wiseweb-works.github.io/blog/de/post/ssl-konfigurasyonu/>🇩🇪</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/wiseweb-works/blog/tree/master/content/post/ssl-konfigurasyonu.md rel="noopener noreferrer" target=_blank>Düzenle</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>İçindekiler</span></summary><div class=inner><ul><li><a href=#linux-sunucularda-ssl-g%c3%bcvenli%c4%9fini-art%c4%b1rma aria-label="Linux Sunucularda SSL güvenliğini artırma">Linux Sunucularda SSL güvenliğini artırma</a><ul><li><a href=#basit-konfig%c3%bcrasyon aria-label="Basit konfigürasyon">Basit konfigürasyon</a></li><li><a href=#%c3%b6nerilen-ayarlar aria-label="Önerilen ayarlar">Önerilen ayarlar</a></li><li><a href=#ileri-seviye-ayarlar aria-label="İleri Seviye Ayarlar">İleri Seviye Ayarlar</a></li></ul></li><li><a href=#son aria-label=Son>Son</a></li></ul></div></details></div><div class=post-content><h1 id=linux-sunucularda-ssl-güvenliğini-artırma>Linux Sunucularda SSL güvenliğini artırma<a hidden class=anchor aria-hidden=true href=#linux-sunucularda-ssl-güvenliğini-artırma>#</a></h1><p>Bugün sizlere mevcut sunucunuzda eğer bir websitesi ve/veya App serve ediyorsanız mutlaka ihtiyacınız olan SSL bağlantısından ve bununla bağlantılı olarak openssl kütüphanesinden bahsedeceğim. SSL (Secure Socket Layer) ve TLS (Transport Layer Security) sunucunuza bağlanmak isteyen kişileri siteniz ile güvenli şekilde iletişim kurmasına imkan sağlayan bir bağlantı şeklidir. Eskiden SSL v1-v3 arasında değişen sürümler mevcut ve siteler genelde bu SSL sürümlerini kullanırken artık SSL siteler tarafından terk edilmiş ve yerini daha güvenli olan TLS&rsquo;ye bırakmıştır. Fakat yine de işin anlatımı kısmında ve config dosyalarını düzenlerken halen &ldquo;ssl&rdquo; kelimesini kullanmamız gerekecektir. Bunu ufak bir espiri ile de anlatmak gerekirse eğer bir uygulamanın 64 bit versiyonunu indirmek istediğiniz aman &ldquo;amd_64&rdquo; olarak neden geçtiğini hiç düşündünüz mü? Çünkü 64 bit&rsquo;e ilk geçen AMD olduğu için buna bir saygı göstergesi ve/veya alışkanlık olarak amd_64 olarak kaldı bu isimlendirme. Aynı şekilde de şu an TLS kullanıyor olmamıza rağmen isimlendirme ve konfigürasyon parametreleri &ldquo;SSL&rdquo; olarak kaldı.</p><p>Daha önceki yazımızda olduğu gibi süreci yine basit, önerilen ve ileri-seviye olarak üç farklı başlık altında anlatacağım. Başlık içerikleri kişisel gerekliliklere göre aşamalı düşünülmüştür. Başlıklar bir biri ile bağlantılı olmasına rağmen istenilen bir aşamada bırakılması sorun oluşturmayacaktır.</p><h2 id=basit-konfigürasyon>Basit konfigürasyon<a hidden class=anchor aria-hidden=true href=#basit-konfigürasyon>#</a></h2><p>Öncelikle içinde bulunduğumuz Linux sürümünün paket yöneticisi ile güncellemeleri konsol üzerinden yüklememiz gerekmektedir.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Ubuntu için: sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Fedora için: sudo yum update -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Arch Linux için: sudo pacman -Syyu
</span></span></code></pre></div><p>Güncellemeler yüklendikten sonra ise sunucunuzdaki (Benim olayımda Ubuntu) nginx/apache servisini (ki bu servis dışarıdan gelen web bağlantılarını almanıza yarayan servistir) yapılandırmaya başlıyoruz. Nginx servisinin ayarlarının tutulduğu dosya genel itibariyle &ldquo;/etc/nginx/nginx.conf&rdquo; konumunda bulunur. Bunu kendi kullandığımız metin editörlerinden istediğimiz biriyle ama sudo (yani yönetici) yetkilerine sahip bir kullanıcı ile açmamız gerekmektedir.</p><p>Ubuntu üzerinden devam edecek olursak (Tek Ip Tek Sunucu Yapılandırması)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/nginx/nginx.config <span style=color:#75715e># Ayar dosyasını açmaya yarayan komut</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Eklenecek (varsa değiştirilecek) başlıklar
</span></span><span style=display:flex><span>listen 443 ssl http2; &gt;&gt; ipv4 üzerinden 443 portuna gelen istekleri http2 protokolü ile karşılayıp ssl bağlantısı kurmaya yarıyor.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>listen [::]:443 ssl http2; &gt;&gt; ipv6 üzerinden 443 portuna gelen istekleri http2 protokolü ile karşılayıp ssl bağlantısı kurmaya yarıyor. (Eğer ipv6 desteğiniz yok ise veya native olarak desteklemek istemiyorsanız kaldırabilirsiniz)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server_name SUNUCU_ADINIZ; &gt;&gt; Eğer sunucu adınızı default olarak belirlemek istemiyorsanız bir Server Name Indicator belirleyebilirsiniz. Bu gelen tüm istekleri karşılamak yerine sadece sunucu adınıza gelen istekleri karşılamaya yarar.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_certificate /etc/letsencrypt/live/SUNUCU_ADINIZ/fullchain.pem; &gt;&gt; Eğer free ssl için Let&#39;s Encrypt kullanıyor iseniz default sertifika konumu burasıdır. Aksi halde kendi sertifika dosyanız ile değiştirin.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_certificate_key /etc/letsencrypt/live/SUNUCU_ADINIZ/privkey.pem; &gt;&gt; Eğer free ssl için Let&#39;s Encrypt kullanıyor iseniz default private key konumu burasıdır. Aksi halde kendi private key dosya konumunuz ile değiştirin.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_protocols TLSv1.3 TLSv1.2;  &gt;&gt; Sadece en güncel ve en güvenilir TLS protokollerini kabul etmek için gerekli komut.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_prefer_server_ciphers on; &gt;&gt; Sunucu ile istemcinin konuşması sırasında &#34;tamam nelerimiz var bakalım&#34; diye konuştuklarını tahmin ettiğim :D kısımda sunucunun sadece kendi seçtiği şifreleme algoritmaları ile bu görüşmeyi devam ettireceğini söylemesine yarayan komut. Kısacası işine gelirse böyle işine gelmezse konuşmuyorum.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_ecdh_curve secp521r1:secp384r1; &gt;&gt; Ekliptik eğrileri kullanmamız gereken durumlarda hangi eğrileri tercih ettiğimizi bildiren komuttur.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_ciphers DH-RSA-AES256-SHA:DH-RSA-AES256-SHA256:DHE-RSA-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDH-ECDSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDH-RSA-AES256-SHA:AECDH-AES256-SHA:ECDHE-ECDSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:ECDH-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDH-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-CCM:DHE-RSA-AES256-CCM8:ECDHE-ECDSA-AES256-CCM:ECDHE-ECDSA-AES256-CCM8:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305; &gt;&gt; En güvenilir bulduğum SSL algoritmalarının bir araya getirilerek sadece bunları kullanmasını sunucuya söyleyen kod.
</span></span></code></pre></div><p>Tek tek araştırmak isteyenler için tüm cipherlar: &ldquo;<a href=https://testssl.sh/openssl-iana.mapping.html%22>https://testssl.sh/openssl-iana.mapping.html"</a></p><p>Ayarları yaptıktan sonra kontrol etmek isterseniz: &ldquo;sudo nginx -t&rdquo; komutunu kullanabilirsiniz. Eğer bir hata mesajı görmez iseniz &ldquo;sudo systemctl restart nginx&rdquo; veya &ldquo;sudo service nginx restart&rdquo; komutu ile ayarları uygulayıp servisi baştan başlatabilirsiniz</p><h2 id=önerilen-ayarlar>Önerilen ayarlar<a hidden class=anchor aria-hidden=true href=#önerilen-ayarlar>#</a></h2><p>Bir önceki ayarlara ek olarak performans özelinde bazı iyileştirmeler ve bunun yanı sıra sitenizin SSL test sitelerinde üst sıralara çıkmasını sağlayacak bazı ek konfigürasyonlar yapacağız. Bunun ardından ise sitenizin kullanıcı ile erişiminde faydalı olarak bazı başlıkları (header) ve sitenizin kaynaklarının üçüncü kişi siteler tarafından sömürülmemesi için bir takım iyileştirmeler yapacağız.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Eklenecek (varsa değiştirilecek) başlıklar
</span></span><span style=display:flex><span>ssl_session_cache shared:TLS:2m; &gt;&gt; TLS bağlantılarının işçiler (nginx workers) arasında nasıl dağıtılacağını ve ne kadar süre ile bağlantıların ortak kullanılacağını belirten kod
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_buffer_size 4k; &gt;&gt; SSL isteklerine cevap verirken ve handshake sonrası paket gönderimi yaparken paketlerin kaçlık konteynırlara bölüneceğini belirten kod. Daha düşük bir değer daha çok paket gönderilmesi ama daha az taşma (overhead) anlamına gelir.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_stapling on; &gt;&gt; OCSP zımbalama özelliğini aktif hale getirir
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssl_stapling_verify on; OCSP zımbalamanın üst ve kök sunucularda dahil olmak üzere doğrulanması özelliğini açar.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>resolver 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001; &gt;&gt; Cloudlfare ile OCSP zımbalama doğrulamasının yapılmasını sağlar. Eğer IPV6 kullanmıyor veya native olarak desteklemek istemiyorsanız ipv6 adreslerini silebilirsiniz.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header X-Content-Type-Options &#34;nosniff&#34; always; &gt;&gt; Tarayıcıların MIME içeriklerini anlamak için koklama (sniff) yapmasını engeleyen başlık değeridir.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header X-Xss-Protection &#34;1; mode=block&#34; always; &gt;&gt; Olası bir XSS açığında kullanıcıların beyaz ekran görmesini sağlayarak açığı bir nebze de olsa engelleyen bir başlıktır.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header X-Frame-Options &#34;SAMEORIGIN&#34; always; &gt;&gt; Herhangi bir şekilde i-frame vb bir kod ile sunucunuzun bir sayfasının başka bir sayfada gösterilmesini ve/veya alt-alta üst-üste yayımlanmasını engeller. Sadece siz kendi siteniz içerisinde kendi sitenizden bir pencere yayımlayabilirsiniz.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Referrer-Policy &#34;no-referrer-when-downgrade&#34; always; &gt;&gt; Daha alt güvenlik önlemine sahip bir siteye yönlendirme veya link verdiğinizde otomatik olarak referrer başlığı eklemez ve sitenizden trafik geldiği belli olmaz.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Content-Security-Policy &#34;default-src &#39;self&#39; https: data: &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;&#34; always; &gt;&gt; Sizin ve diğer kullanıcıların dışarıdan çağırabilecekleri isteklerin hangi koşullar altında çağrılabileceğini düzenleyen başlık. Ben default olarak https üzerinden gelen bazı kaynaklara güveniyorum.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Permissions-Policy &#34;camera=(), fullscreen=(self), geolocation=(), microphone=(), payment=()&#34; always; &gt;&gt; Tarayıcıya hangi izinleri isteyeceğinizi veya hangilerine hiç ihtiyacınız olmayacağını belirterek çeşitli zehirleme türleri (cache-poisoning veya js-poisoning) ile sizin siteniz üzerinden bilgi toplanmasını engeller.
</span></span></code></pre></div><p>Ayarları yaptıktan sonra kontrol etmek isterseniz: &ldquo;sudo nginx -t&rdquo; komutunu kullanabilirsiniz. Eğer bir hata mesajı görmez iseniz &ldquo;sudo systemctl restart nginx&rdquo; veya &ldquo;sudo service nginx restart&rdquo; komutu ile ayarları uygulayıp servisi baştan başlatabilirsiniz.</p><h2 id=ileri-seviye-ayarlar>İleri Seviye Ayarlar<a hidden class=anchor aria-hidden=true href=#ileri-seviye-ayarlar>#</a></h2><p>Öncelikle sitenize sadece ssl üzerinden bağlanması gerektiğini gösterecek bir başlık ekleyeceğiz. Bu sayede sizin sitenize daha önce girmiş olanlar ve hali hazırda bu başlığı tarayıcısında mevcut olanlar istese bile sizin sitenize Non-SSL şekilde erişemeyecekler. Ardından ise HTTP oturumlarına kullanılması gereken SSL sertifikalarını zımbalayacağız ve önceki yöntemin yanından hangi sertifikalar ile bağlanması gerekeceğini de önceden belirtmiş olacağız. Bu sayede yetkili bir üst sertifika yöneticisi veya kök yöneticisi olsanız dahi sizin adınıza imzaladığı sertifika ile sizin sitenize bağlanamayacaklar. Zamaında Türkiyede yerleşik E-Tuğra Kök Sertifika sağlayıcısı *.google.com adresine bir sertifika imzaladı. Biraz araştırırsanız hangi dönemde meydana geldiğini ve nedenini (ne kadar kötü sonuçlara neden olabileceğini) fardekersiniz. Şimdi başlayalım son konfigürasyon kısmına.</p><p>Öncelikle sitenizin SSL üzerinden hiçbir soruna neden olmaksızın erişilebiliyor olduğundan emin olun. Ardından nginx konfig dosyasına aşağıdaki başlıklardan isteğinize göre birini ekleyin. Ama dikkat edin sadece bir tanesini.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>add_header Strict-Transport-Security &#34;max-age=2592000;&#34; always; &gt;&gt; Sitenize 30 gün boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık. (Alt alan adları dahil değil)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Strict-Transport-Security &#34;max-age=2592000; includeSubDomains;&#34; always; &gt;&gt; Sitenize alt alan adları da dahil olmak üzere 30 gün boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Strict-Transport-Security &#34;max-age=31536000; includeSubDomains;&#34; always; &gt;&gt; Sitenize alt alan adları da dahil olmak üzere 1 yıl boyunca sadece HTTPS üzerinden erişilebileceğini belirten başlık.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Strict-Transport-Security &#34;max-age=31536000; includeSubDomains; preload&#34; always; &gt;&gt; Sitenize alt alan adları da dahil olmak üzere 1 yıl boyunca sadece HTTPS üzerinden erişilebileceğini ve bu başlığın tarayıcıların önbelleğine alınması talimatını veren başlık. Ayrıca yeni çıkan tarayıcılar sitenize daha önce hiç girmese dahi bu başlıktan haberdar olacaktır.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>add_header Strict-Transport-Security &#34;max-age=0; includeSubDomains&#34;; &gt;&gt; HSTS özelliğini ve preload listesi üyeliğini tamamen kaldırmaya yarayan başlık.
</span></span></code></pre></div><p>Yukarıda belirtilen başlığı ekledikten sonra şimdi kullanmış olduğunuz ssl sertifikasının özetinin HTTP oturumuna zımbalanmasına geldi. Bu aşamada mevcut sertifikanızın bir özetini çıkarmamız, üst imzalayan yetkilinin sertifikasının özetini çıkarmamız ve en üst kök sertifika yetkilisi de dahil olmak üzere tüm zinciri tamamlayana kadar bu özet çıkarma sürecini devam ettirmemiz gerekiyor. Bu nedenle root kullanıcısı veya sudo yetkisine sahip bir kullanıcı ile aşağıdaki komutları sırasıyla çalıştırıyoruz. (Anlatım Let&rsquo;s Encrypt özelinde yapılmıştır.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>1<span style=color:#f92672>]</span> cat /etc/letsencrypt/live/SUNUCU_ADINIZ/cert.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 &gt;&gt; Bu komut sizin sitenize ait sertifikanın özetini çıkaracaktır. Sonuç değerini bir yere kopyalayın.
</span></span><span style=display:flex><span>2<span style=color:#f92672>]</span> curl -s https://letsencrypt.org/certs/lets-encrypt-x4-cross-signed.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 &gt;&gt; Bu komut letsencrypt<span style=color:#e6db74>&#39;e ait çoklu imzalı sertifikalardan bir tanesinin özetini çıkaracaktır.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>3] curl -s https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 &gt;&gt; Bu komut letsencrypt&#39;</span>e ait çoklu imzalı sertifikalardan bir tanesinin özetini çıkaracaktır.
</span></span><span style=display:flex><span>4<span style=color:#f92672>]</span> curl -s https://letsencrypt.org/certs/isrgrootx1.pem | openssl x509 -pubkey | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64 &gt;&gt; Bu komut letsencrypt<span style=color:#e6db74>&#39;e ait kök (en üst) sertifikasının özetini çıkaracaktır.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Nginx config dosyasına aşağıdaki değer eklenir
</span></span></span><span style=display:flex><span><span style=color:#e6db74>5] add_header Public-Key-Pins &#39;</span>pin-sha256<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ILK_SONUC&#34;</span>; pin-sha256<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;IKINCI_SONUC&#34;</span>; pin-sha256<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UCUNCU_SONUC&#34;</span>; pin-sha256<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;DORDUNCU_SONUC&#34;</span>; max-age<span style=color:#f92672>=</span>2592000; includeSubDomains<span style=color:#960050;background-color:#1e0010>&#39;</span> always; &gt;&gt; Sitenize <span style=color:#ae81ff>30</span> gün boyunca sadece belirtilen sertifika ile bağlanılmasına izin verir. Max-age değerini isteğe bağlı olarak artırabilirsiniz. Sertifika geçerlilik süreniz <span style=color:#ae81ff>30</span> günden daha az kalmadan başlığı devredışı bırakmanız veya yeni sertifika edinmeniz ve beşinci değer olarak onu eklemeniz gerekmektedir.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Bonus olarak sunucunuzun yapmasının çok uzun süreceği ama faydası çok olan bir komut daha göstermek istiyorum.
</span></span><span style=display:flex><span>6<span style=color:#f92672>]</span> openssl dhparam -out /etc/nginx/dhparams.pem <span style=color:#ae81ff>4096</span> &gt;&gt; Bu komutu uygulaması 15dk ile <span style=color:#ae81ff>1</span> saat arasında sürebilir.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>İşlem bittikten sonra nginx konfig dosyasına aşağıdaki komutu eklemeniz gerekmektedir.
</span></span><span style=display:flex><span>ssl_dhparam /etc/nginx/dhparam.pem; &gt;&gt; Diffie-Hellman anahtar değişim algoritması sırasında kullanılacak değerleri default değerler dışında az önce oluşturduğumuz gizli değerler ile değiştirmeye yarayan komut.
</span></span></code></pre></div><p>Ayarları yaptıktan sonra &ldquo;sudo nginx -t&rdquo; ve ardından eğer bir hata mesajı görmez iseniz &ldquo;sudo service nginx restart&rdquo; komutu ile ayarları uygulayıp servisi baştan başlatın. Artık sizin belirlediğiniz konfigürasyon ve şartlar ile bağlantı sağlanacaktır. Eğer öncesi/sonrası puanlama farkını görmek isterseniz aşağıdaki görsellere bakabilirsiniz veya kendi sitenizi &ldquo;<a href=https://www.ssllabs.com/ssltest/index.html%22>https://www.ssllabs.com/ssltest/index.html"</a> adresinden test edebilirsiniz.</p><p>İLK HALİ
<picture><source srcset=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-ilk-hali-ssllabs.avif type=image/avif><source srcset=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-ilk-hali-ssllabs.webp type=image/webp><img src=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-ilk-hali-ssllabs.png loading=lazy decoding=async width=min(100%, 720px) height=auto><caption><center><b><small>SSL Labs test sonucu</small></b></center></caption></picture></p><p>SON DURUM
<picture><source srcset=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-son-hali-ssllabs.avif type=image/avif><source srcset=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-son-hali-ssllabs.webp type=image/webp><img src=https://wiseweb-works.github.io/blog/images/ssl-anlatim/ssl-son-hali-ssllabs.png loading=lazy decoding=async width=min(100%, 720px) height=auto><caption><center><b><small>SSL Labs test sonucu</small></b></center></caption></picture></p><p>Neden Cipher Strength %100 değil derseniz TLS 1.3 ile otomatik gelen ve biz istemesek de eklenen &ldquo;TLS_AES_128_GCM_SHA256 (0x1301)&rdquo; yüzünden şu an %100 yapmak mümkün değil. TLS 1.3&rsquo;ü kapatırım o zaman gelmez diye düşünürseniz o zaman da başka yerden puanınız gidiyor maalesef.</p><h1 id=son>Son<a hidden class=anchor aria-hidden=true href=#son>#</a></h1><p>Bu yazı daha önce <a href=https://teknolojirehberleri.xyz>https://teknolojirehberleri.xyz</a> adresinde yayımlanmıştır. Kişisel portfolyo oluşturmak adına şahsi sitemde yeniden yayımlama ihtiyacı hissettim.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wiseweb-works.github.io/blog/tags/linux/>linux</a></li><li><a href=https://wiseweb-works.github.io/blog/tags/ssl/>ssl</a></li><li><a href=https://wiseweb-works.github.io/blog/tags/security/>security</a></li><li><a href=https://wiseweb-works.github.io/blog/tags/audit/>audit</a></li></ul><nav class=paginav><a class=prev href=https://wiseweb-works.github.io/blog/post/ecc-ssl-sertifikasi/><span class=title>« Önceki</span><br><span>Linux Sunucuda ECC SSL Sertifikası Üretme</span></a>
<a class=next href=https://wiseweb-works.github.io/blog/post/ssh-guvenligi/><span class=title>Sonraki »</span><br><span>Linux Sunucularda SSH Güvenliği Artırma</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://wiseweb-works.github.io/blog/>Wise</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopyala";function s(){t.innerHTML="Kopyalandı!",setTimeout(()=>{t.innerHTML="Kopyala"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>